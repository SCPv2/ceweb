<!--
==============================================================================
Copyright (c) 2025 Stan H. All rights reserved.

This software and its source code are the exclusive property of Stan H.

Use is strictly limited to 2025 SCPv2 Advance training and education only.
Any reproduction, modification, distribution, or other use beyond this scope is
strictly prohibited without prior written permission from the copyright holder.

Unauthorized use may lead to legal action under applicable law.

Contact: ars4mundus@gmail.com
==============================================================================
-->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ë¬¸/ê²°ì œ - Creative Energy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f8f8;
            color: #333;
            line-height: 1.6;
        }

        /* Header */
        .header {
            background-color: #fff;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .back-btn {
            font-size: 18px;
            cursor: pointer;
            color: #666;
        }

        .header-title {
            font-size: 16px;
            font-weight: bold;
            color: #000;
        }

        .cart-icon {
            position: relative;
            font-size: 18px;
            color: #666;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4444;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 16px;
            text-align: center;
        }

        /* Main Container */
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            min-height: calc(100vh - 70px);
        }

        /* Section Headers */
        .section-header {
            width: 100%;
            background: #666;
            color: white;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
        }

        /* Order Info Section */
        .order-section {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            color: #333;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
        }

        .form-input:focus {
            border-color: #666;
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
            outline: none;
        }

        .phone-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .phone-select {
            width: 80px;
        }

        .phone-input {
            flex: 1;
        }

        /* Product Quantity Section */
        .quantity-section {
            padding: 20px;
        }

        .product-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .product-image {
            width: 60px;
            height: 60px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-details {
            flex: 1;
        }

        .product-title {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }

        .product-subtitle {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .product-price {
            font-size: 14px;
            font-weight: bold;
            color: #000;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .stock-info {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }

        .stock-info.soldout {
            color: #ff4444;
            font-weight: bold;
        }

        .quantity-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: #666;
        }

        .quantity-btn:hover {
            background: #f0f0f0;
        }

        .quantity-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .quantity-input {
            width: 60px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }

        /* Price Summary */
        .price-summary {
            border-top: 1px solid #e0e0e0;
            padding: 20px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .price-row.total {
            font-size: 16px;
            font-weight: bold;
            border-top: 1px solid #e0e0e0;
            padding-top: 10px;
            margin-top: 10px;
            color: #ff4444;
        }

        /* Bottom Fixed Buttons */
        .bottom-actions {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 600px;
            width: 100%;
            background: white;
            border-top: 1px solid #e0e0e0;
            padding: 15px 20px;
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #666;
            border: 1px solid #ddd;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-primary {
            background: #ff4444;
            color: white;
        }

        .btn-primary:hover {
            background: #e03333;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #333;
        }

        .modal-text {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            min-width: 80px;
        }

        .modal-btn-primary {
            background: #ff4444;
            color: white;
        }

        .modal-btn-secondary {
            background: #f0f0f0;
            color: #666;
            border: 1px solid #ddd;
        }

        /* Order Confirmation Section */
        .confirmation-section {
            display: none;
        }

        .confirmation-section.show {
            display: block;
        }

        .order-product-image {
            width: 50px;
            height: 50px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .order-product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .order-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .order-detail-row:last-child {
            border-bottom: none;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                max-width: 100%;
            }

            .bottom-actions {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="back-btn" onclick="goBack()">â†</div>
        <div class="header-title">ì£¼ë¬¸/ê²°ì œ</div>
        <div class="cart-icon">
            ğŸ›’
            <div class="cart-badge" id="cartBadge">1</div>
        </div>
    </div>

    <div class="container">
        <!-- Order Form Section -->
        <div id="orderFormSection">
            <div class="section-header">ì£¼ë¬¸ì ì •ë³´</div>
            <div class="order-section">
                <div class="form-group">
                    <label class="form-label">ì´ë¦„ *</label>
                    <input type="text" class="form-input" id="customerName" placeholder="ì£¼ë¬¸ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">íœ´ëŒ€í° ë²ˆí˜¸ *</label>
                    <div class="phone-group">
                        <select class="form-select phone-select" id="phonePrefix">
                            <option value="010">010</option>
                            <option value="011">011</option>
                            <option value="016">016</option>
                            <option value="017">017</option>
                            <option value="018">018</option>
                            <option value="019">019</option>
                        </select>
                        <input type="text" class="form-input phone-input" id="phoneMiddle" placeholder="1234" maxlength="4">
                        <input type="text" class="form-input phone-input" id="phoneLast" placeholder="5678" maxlength="4">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ì´ë©”ì¼</label>
                    <input type="email" class="form-input" id="email" placeholder="example@email.com">
                </div>
            </div>

            <div class="section-header">ìƒí’ˆ ì •ë³´</div>
            <div class="quantity-section">
                <div id="product-info" class="product-info">
                    <!-- ìƒí’ˆ ì •ë³´ê°€ ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
                
                <div class="quantity-controls">
                    <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                    <input type="number" class="quantity-input" id="quantity" value="1" min="1" max="99" onchange="updateTotal()">
                    <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
                </div>
                
                <div class="stock-info" id="stockInfo">
                    ì¬ê³ : <span id="stockDisplay">-</span>ê°œ
                </div>
            </div>

            <div class="section-header">ê²°ì œ ì •ë³´</div>
            <div class="price-summary">
                <div class="price-row">
                    <span>ìƒí’ˆê¸ˆì•¡</span>
                    <span id="product-price">0ì›</span>
                </div>
                <div class="price-row">
                    <span>ë°°ì†¡ë¹„</span>
                    <span>ë¬´ë£Œ</span>
                </div>
                <div class="price-row total">
                    <span>ì´ ê²°ì œê¸ˆì•¡</span>
                    <span id="total-price">0ì›</span>
                </div>
            </div>
        </div>

        <!-- Order Confirmation Section -->
        <div id="confirmationSection" class="confirmation-section">
            <div class="section-header">ì£¼ë¬¸ ì™„ë£Œ</div>
            <div class="order-section">
                <div class="modal-icon">âœ…</div>
                <div class="modal-title">ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</div>
                
                <div id="confirmationProductInfo" class="product-info">
                    <!-- ìƒí’ˆ ì •ë³´ -->
                </div>
                
                <div id="confirmationOrderDetails">
                    <!-- ì£¼ë¬¸ ìƒì„¸ ì •ë³´ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Actions -->
    <div class="bottom-actions">
        <button class="btn btn-secondary" onclick="goBack()" id="backButton">ëŒì•„ê°€ê¸°</button>
        <button class="btn btn-primary" onclick="processOrder()" id="orderButton">ì£¼ë¬¸í•˜ê¸°</button>
        <button class="btn btn-primary" onclick="goToShop()" id="completeButton" style="display: none;">ì‡¼í•‘ ê³„ì†í•˜ê¸°</button>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-icon">â“</div>
            <div class="modal-title">ì£¼ë¬¸ í™•ì¸</div>
            <div class="modal-text" id="confirmText">
                ì •ë§ë¡œ ì£¼ë¬¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeConfirmModal()">ì·¨ì†Œ</button>
                <button class="modal-btn modal-btn-primary" onclick="confirmOrder()">ì£¼ë¬¸í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Object Storage ì „ìš© API ì„¤ì • ë¡œë“œ -->
    <script src="../web-server/api-config-obj.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let productData = {};
        let unitPrice = 0;
        let maxStock = 0;
        let orderInfo = {};

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadProductData();
            initializeForm();
        });

        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ìƒí’ˆ ë°ì´í„° ë¡œë“œ
        function loadProductData() {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('data');
            
            if (data) {
                try {
                    const decodedData = decodeURIComponent(atob(data));
                    productData = JSON.parse(decodedData);
                    console.log('ìƒí’ˆ ë°ì´í„° ë¡œë“œë¨:', productData);
                    
                    // ìƒí’ˆ ì •ë³´ ë Œë”ë§
                    renderProductInfo();
                    
                    // ì¬ê³  ì •ë³´ ì¡°íšŒ (Object Storage ë²„ì „ API ì‚¬ìš©)
                    checkProductStock();
                    
                } catch (error) {
                    console.error('ìƒí’ˆ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', error);
                    alert('ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    goBack();
                }
            } else {
                alert('ìƒí’ˆ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                goBack();
            }
        }

        // ìƒí’ˆ ì •ë³´ ë Œë”ë§
        function renderProductInfo() {
            const productInfoContainer = document.getElementById('product-info');
            
            if (!productData || !productInfoContainer) {
                console.error('ìƒí’ˆ ë°ì´í„° ë˜ëŠ” ì»¨í…Œì´ë„ˆê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì´ë¯¸ì§€ ê²½ë¡œëŠ” ìƒëŒ€ê²½ë¡œë¡œ ìœ ì§€ (ë™ì  ë³€í™˜ë¨)
            let imagePath = productData.image;
            
            productInfoContainer.innerHTML = `
                <div class="product-image">
                    <img src="${imagePath}" alt="${productData.title}" 
                         onerror="this.style.display='none'; this.parentElement.style.background='linear-gradient(135deg, #f0f0f0, #e0e0e0)';">
                </div>
                <div class="product-details">
                    <div class="product-title">${productData.title || 'ìƒí’ˆëª… ì—†ìŒ'}</div>
                    ${productData.subtitle ? `<div class="product-subtitle">${productData.subtitle}</div>` : ''}
                    <div class="product-price">${productData.price || 'ê°€ê²© ì •ë³´ ì—†ìŒ'}</div>
                </div>
            `;
        }

        // ìˆ˜ëŸ‰ ë³€ê²½
        function changeQuantity(change) {
            const quantityInput = document.getElementById('quantity');
            let currentQty = parseInt(quantityInput.value) || 1;
            let newQty = currentQty + change;
            
            if (newQty < 1) newQty = 1;
            if (newQty > maxStock) newQty = maxStock;
            if (newQty > 99) newQty = 99;
            
            quantityInput.value = newQty;
            updateTotal();
        }

        // ì´ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
        function updateTotal() {
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const totalPrice = unitPrice * quantity;
            
            // ê°€ê²© í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('product-price').textContent = totalPrice.toLocaleString() + 'ì›';
            document.getElementById('total-price').textContent = totalPrice.toLocaleString() + 'ì›';
        }

        // ìƒí’ˆ ì¬ê³  ì •ë³´ ì¡°íšŒ (Object Storage ë²„ì „ API ì‚¬ìš©)
        async function checkProductStock() {
            try {
                console.log('Object Storage APIë¡œ ì¬ê³  ì¡°íšŒ ì¤‘...');
                
                const response = await apiRequestObj(`/objorders/products/${productData.id}/inventory`);
                
                if (response.success && response.product) {
                    const product = response.product;
                    maxStock = product.stock_quantity || 0;
                    unitPrice = product.price_numeric || 0;
                    
                    // ì¬ê³  ì •ë³´ ì—…ë°ì´íŠ¸
                    const stockDisplay = document.getElementById('stockDisplay');
                    const stockInfo = document.getElementById('stockInfo');
                    
                    if (maxStock <= 0) {
                        stockDisplay.textContent = 'ë§¤ì§„';
                        stockInfo.classList.add('soldout');
                        document.getElementById('orderButton').disabled = true;
                        document.getElementById('orderButton').textContent = 'í’ˆì ˆ';
                    } else {
                        stockDisplay.textContent = maxStock;
                        stockInfo.classList.remove('soldout');
                    }
                    
                    // ê°€ê²© ì—…ë°ì´íŠ¸
                    updateTotal();
                    
                } else {
                    throw new Error('ì¬ê³  ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('ì¬ê³  ì¡°íšŒ ì˜¤ë¥˜:', error);
                document.getElementById('stockDisplay').textContent = 'ì¡°íšŒ ì‹¤íŒ¨';
            }
        }

        // ì£¼ë¬¸ ì²˜ë¦¬ (Object Storage ë²„ì „ API ì‚¬ìš©)
        async function processOrder() {
            if (!validateOrderForm()) {
                return;
            }
            
            const customerName = document.getElementById('customerName').value.trim();
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            
            // í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('confirmText').innerHTML = 
                `<strong>${productData.title}</strong><br>` +
                `ìˆ˜ëŸ‰: ${quantity}ê°œ<br>` +
                `ì´ì•¡: ${(unitPrice * quantity).toLocaleString()}ì›<br><br>` +
                `ì£¼ë¬¸ì: ${customerName}`;
            
            document.getElementById('confirmModal').classList.add('show');
        }

        // ì£¼ë¬¸ í™•ì¸
        async function confirmOrder() {
            closeConfirmModal();
            
            const customerName = document.getElementById('customerName').value.trim();
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            
            try {
                console.log('Object Storage APIë¡œ ì£¼ë¬¸ ìƒì„± ì¤‘...');
                
                const orderData = {
                    customerName: customerName,
                    productId: productData.id,
                    quantity: quantity
                };
                
                const response = await apiRequestObj('/objorders/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderData)
                });
                
                if (response.success) {
                    orderInfo = response.order;
                    showOrderCompletion();
                } else {
                    alert(response.message || 'ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('ì£¼ë¬¸ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ì£¼ë¬¸ ì™„ë£Œ í™”ë©´ í‘œì‹œ
        function showOrderCompletion() {
            document.getElementById('orderFormSection').style.display = 'none';
            document.getElementById('confirmationSection').classList.add('show');
            document.getElementById('backButton').style.display = 'none';
            document.getElementById('orderButton').style.display = 'none';
            document.getElementById('completeButton').style.display = 'block';
            
            // ì£¼ë¬¸ ì™„ë£Œ ì •ë³´ ë Œë”ë§
            renderOrderConfirmation();
        }

        // ì£¼ë¬¸ ì™„ë£Œ ì •ë³´ ë Œë”ë§
        function renderOrderConfirmation() {
            const productInfoContainer = document.getElementById('confirmationProductInfo');
            const orderDetailsContainer = document.getElementById('confirmationOrderDetails');
            
            // ì´ë¯¸ì§€ ê²½ë¡œëŠ” ìƒëŒ€ê²½ë¡œë¡œ ìœ ì§€ (ë™ì  ë³€í™˜ë¨)
            let imagePath = productData.image;
            
            // ìƒí’ˆ ì •ë³´ ë Œë”ë§
            productInfoContainer.innerHTML = `
                <div class="order-product-image">
                    <img src="${imagePath}" alt="${productData.title}" 
                         onerror="this.style.display='none'; this.parentElement.style.background='linear-gradient(135deg, #f0f0f0, #e0e0e0)';">
                </div>
                <div class="order-product-details">
                    <h3>${productData.title}</h3>
                    ${productData.subtitle ? `<p>${productData.subtitle}</p>` : ''}
                </div>
            `;
            
            // ì£¼ë¬¸ ìƒì„¸ ì •ë³´ ë Œë”ë§
            orderDetailsContainer.innerHTML = `
                <div class="order-detail-row">
                    <span>ì£¼ë¬¸ì</span>
                    <span>${orderInfo.customerName}</span>
                </div>
                <div class="order-detail-row">
                    <span>ì£¼ë¬¸ ìˆ˜ëŸ‰</span>
                    <span>${orderInfo.quantity}ê°œ</span>
                </div>
                <div class="order-detail-row">
                    <span>ê²°ì œ ê¸ˆì•¡</span>
                    <span>${orderInfo.totalPrice.toLocaleString()}ì›</span>
                </div>
                <div class="order-detail-row">
                    <span>ì£¼ë¬¸ ë²ˆí˜¸</span>
                    <span>#${orderInfo.id}</span>
                </div>
                <div class="order-detail-row">
                    <span>ì£¼ë¬¸ ì¼ì‹œ</span>
                    <span>${new Date(orderInfo.orderDate).toLocaleString('ko-KR')}</span>
                </div>
            `;
        }

        // í¼ ìœ íš¨ì„± ê²€ì‚¬
        function validateOrderForm() {
            const customerName = document.getElementById('customerName').value.trim();
            const phoneMiddle = document.getElementById('phoneMiddle').value.trim();
            const phoneLast = document.getElementById('phoneLast').value.trim();
            
            if (!customerName) {
                alert('ì£¼ë¬¸ì ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('customerName').focus();
                return false;
            }
            
            if (!phoneMiddle || !phoneLast) {
                alert('íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                if (!phoneMiddle) document.getElementById('phoneMiddle').focus();
                else document.getElementById('phoneLast').focus();
                return false;
            }
            
            if (!/^\d{4}$/.test(phoneMiddle) || !/^\d{4}$/.test(phoneLast)) {
                alert('íœ´ëŒ€í° ë²ˆí˜¸ëŠ” ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            if (quantity > maxStock) {
                alert(`ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (ìµœëŒ€ ${maxStock}ê°œ)`);
                return false;
            }
            
            return true;
        }

        // í¼ ì´ˆê¸°í™”
        function initializeForm() {
            // ê¸°ë³¸ê°’ ì„¤ì •
            document.getElementById('quantity').value = productData.quantity || 1;
            updateTotal();
        }

        // ë’¤ë¡œ ê°€ê¸°
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                // shop_obj.htmlë¡œ ì´ë™ (Object Storage ë²„ì „)
                window.location.href = './shop_obj.html';
            }
        }

        // ì‡¼í•‘ ê³„ì†í•˜ê¸°
        function goToShop() {
            // shop_obj.htmlë¡œ ì´ë™ (Object Storage ë²„ì „)
            window.location.href = './shop_obj.html';
        }

        // í™•ì¸ ëª¨ë‹¬ ë‹«ê¸°
        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
        }

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeConfirmModal();
            }
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
        document.getElementById('confirmModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeConfirmModal();
            }
        });
    </script>
</body>
</html>